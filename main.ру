import os, asyncio, threading
from telethon import TelegramClient, events
from telethon.sessions import StringSession
from http.server import HTTPServer, BaseHTTPRequestHandler

# –¢–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
API_ID = 30893125
API_HASH = '5c73de68f3152f0513292cb495071e0b'

# –ë–µ—Ä–µ–º —Å–µ—Å—Å–∏—é –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Render
SESSION_STR = os.environ.get('TG_SESSION')

# –ü—Ä–æ—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è Render, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –≤—ã–∫–ª—é—á–∞–ª –±–æ—Ç–∞
class HealthHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.end_headers()
        self.wfile.write(b"Aaron is Online")

async def main():
    if not SESSION_STR:
        print("‚ùå –û–®–ò–ë–ö–ê: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è TG_SESSION –ø—É—Å—Ç–∞!")
        return

    # –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫—É —Å–µ—Å—Å–∏–∏
    client = TelegramClient(StringSession(SESSION_STR), API_ID, API_HASH)
    
    @client.on(events.NewMessage(outgoing=True))
    async def handler(event):
        if event.raw_text == '.': 
            await event.edit("üöÄ **–ê–∞—Ä–æ–Ω –≤ —Å–µ—Ç–∏ –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!**")

    print("‚úÖ –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...")
    await client.start()
    print("‚úÖ –ë–û–¢ –£–°–ü–ï–®–ù–û –ó–ê–ü–£–©–ï–ù!")
    await client.run_until_disconnected()

if __name__ == '__main__':
    # –ó–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
    threading.Thread(target=lambda: HTTPServer(('0.0.0.0', 8080), HealthHandler).serve_forever(), daemon=True).start()
    # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
    asyncio.run(main())
