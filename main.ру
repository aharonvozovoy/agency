import os
import asyncio
from telethon import TelegramClient, events
from http.server import HTTPServer, BaseHTTPRequestHandler
import threading

# –¢–í–û–ò –î–ê–ù–ù–´–ï
API_ID = 30893125
API_HASH = '5c73de68f3152f0513292cb495071e0b'
PHONE = '+66618169428'

client = TelegramClient('session_aaron', API_ID, API_HASH)

# –í–µ–±-—Å–µ—Ä–≤–µ—Ä —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –ø–æ—Ä—Ç–∞ 8080
class HealthHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.end_headers()
        self.wfile.write(b"Aaron is alive on 8080")
    def log_message(self, format, *args): return

def run_web_server():
    # –ú—ã –∂–µ—Å—Ç–∫–æ –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º 8080, —Ä–∞–∑ Render –µ–≥–æ –ø—Ä–æ—Å–∏—Ç
    port = 8080
    server = HTTPServer(('0.0.0.0', port), HealthHandler)
    print(f"--- –í–ï–ë-–°–ï–†–í–ï–† –ü–û–î–ù–Ø–¢ –ù–ê –ü–û–†–¢–£ {port} ---")
    server.serve_forever()

# –û–ë–†–ê–ë–û–¢–ß–ò–ö –¢–û–ß–ö–ò
@client.on(events.NewMessage(outgoing=True))
async def action_handler(event):
    if event.raw_text == '.':
        print(">>> –¢–û–ß–ö–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ê! –ú–ï–ù–Ø–Æ –¢–ï–ö–°–¢...")
        await event.edit("üöÄ **–ê–∞—Ä–æ–Ω –∑–∞–ø—É—â–µ–Ω!**\n–°–≤—è–∑—å —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç 8080 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.")

async def main():
    print("--- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö TELEGRAM ---")
    await client.connect()
    
    if not await client.is_user_authorized():
        print("‚ùå –û–®–ò–ë–ö–ê: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å.")
        return

    print("‚úÖ‚úÖ‚úÖ –ë–û–¢ –í –°–ï–¢–ò –ò –ì–û–¢–û–í –ö –†–ê–ë–û–¢–ï")
    await client.run_until_disconnected()

if __name__ == '__main__':
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä –ø–æ—Ä—Ç–∞ 8080
    threading.Thread(target=run_web_server, daemon=True).start()
    # –ó–∞–ø—É—Å–∫–∞–µ–º –¢–µ–ª–µ–≥—Ä–∞–º
    asyncio.run(main())
