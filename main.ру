import os
import asyncio
from telethon import TelegramClient, events
from http.server import HTTPServer, BaseHTTPRequestHandler
import threading

# –¢–í–û–ò –î–ê–ù–ù–´–ï
API_ID = 30893125
API_HASH = '5c73de68f3152f0513292cb495071e0b'
PHONE = '+66618169428'

client = TelegramClient('session_aaron', API_ID, API_HASH)

# –í–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è Render (—á—Ç–æ–±—ã —Å—Ç–∞—Ç—É—Å –±—ã–ª Live)
class SimpleHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.end_headers()
        self.wfile.write(b"Aaron is Online")

def run_port_server():
    port = int(os.environ.get("PORT", 10000))
    server = HTTPServer(('0.0.0.0', port), SimpleHandler)
    server.serve_forever()

# --- –ö–û–ú–ê–ù–î–´ –ë–û–¢–ê ---
@client.on(events.NewMessage(pattern=r'^\.$', outgoing=True))
async def handler(event):
    await event.edit("üöÄ **–ê–∞—Ä–æ–Ω –Ω–∞ —Å–≤—è–∑–∏!**\n–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–ª–∞–∫–µ Render.")

async def main():
    print("--- –ó–ê–ü–£–°–ö –ê–ê–†–û–ù–ê ---")
    await client.connect()
    
    if not await client.is_user_authorized():
        print("‚ùå –û–®–ò–ë–ö–ê: –ù—É–∂–Ω–æ —Å–Ω–æ–≤–∞ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è. –ü—Ä–æ–≤–µ—Ä—å TG_CODE.")
        return

    print("‚úÖ –ë–û–¢ –ü–û–î–ö–õ–Æ–ß–ï–ù –ò –ñ–î–ï–¢ –¢–û–ß–ö–£")
    await client.run_until_disconnected()

if __name__ == '__main__':
    threading.Thread(target=run_port_server, daemon=True).start()
    asyncio.run(main())
