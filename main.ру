import os
import asyncio
from telethon import TelegramClient

# Твои данные БЕЗ лишних пробелов
API_ID = 26521743
API_HASH = '1f67f677d337d456722c8335508c909c'
PHONE = '+79870346313'

# Код подтверждения из Render
TG_CODE = os.environ.get('TG_CODE')

# Очищаем значения на всякий случай
client = TelegramClient('session_aaron', API_ID, API_HASH.strip())

async def main():
    print("--- ПРОВЕРКА ДАННЫХ ---")
    try:
        await client.connect()
    except Exception as e:
        print(f"ОШИБКА ПОДКЛЮЧЕНИЯ: {e}")
        return

    if not await client.is_user_authorized():
        print(f"Авторизация для номера: {PHONE}")
        
        if not TG_CODE:
            print(">>> ЗАПРОС КОДА ОТПРАВЛЕН В ТЕЛЕГРАМ <<<")
            try:
                await client.send_code_request(PHONE)
            except Exception as e:
                print(f"НЕ УДАЛОСЬ ОТПРАВИТЬ КОД: {e}")
                return
        else:
            try:
                print(f"ВХОД С КОДОМ: {TG_CODE}")
                await client.sign_in(PHONE, TG_CODE)
                print("✅ УСПЕХ! Бот работает.")
            except Exception as e:
                print(f"❌ ОШИБКА КОДА: {e}. Удалите TG_CODE и попробуйте снова.")
    else:
        print("✅ Аарон уже авторизован!")

    while True:
        await asyncio.sleep(1000)

if __name__ == '__main__':
    asyncio.run(main())
