import os
import asyncio
from telethon import TelegramClient

# Получаем данные
api_id = os.environ.get('TG_API_ID')
api_hash = os.environ.get('TG_API_HASH')
phone = os.environ.get('TG_PHONE')
code = os.environ.get('TG_CODE')

client = TelegramClient('session_aaron', api_id, api_hash)

async def main():
    print("--- Попытка подключения к Telegram ---")
    await client.connect()
    
    if not await client.is_user_authorized():
        print(f"Аккаунт {phone} не авторизован.")
        if not code:
            print("ЗАПРОС КОДА: Сейчас отправлю код на твой телефон...")
            await client.send_code_request(phone)
            print("КОД ОТПРАВЛЕН! Впиши его в переменную TG_CODE в Render и нажми Save.")
        else:
            print(f"ПРОБУЮ КОД: {code}")
            await client.sign_in(phone, code)
            print("✅ УСПЕХ! Бот залогинился.")
    else:
        print("✅ Бот уже авторизован и работает!")

    while True:
        await asyncio.sleep(1000)

if __name__ == '__main__':
    asyncio.run(main())
